---
sidebar_position: 3
title: iOS Integration Document
id: iOS-Integration-Document
---
# iOS Integration Document (External Use)

## 1. Installation

###The integration should be done with CocoaPods and the following orders should be added to Podfile.

```Objective-C 
pod 'AppWheel'
```

The latest version can be obtained through the official website or by executing pod search AppWheel.
 All methods support Swift calls. Please add the following sentences to the Bridging-Header file.

```Objective-C 
import <PurchaseSDK/AWPurchaseKit.h>
```
>   <font color="red">**Note: This SDK only supports the real machine rather than a simulator for the time being.**</font> 

## 2. SDK Initialization
### Description:
 The SDK initialization method is as follows. Please initialize the SDK in your app as soon as possible according to your own situation.

```Objective-C 
///Please use the following method for versions older than 2.0.1.3.  
AWPurchaseKit configureWithAppId:appid 
                             uid:userId     
                      completion:^(BOOL success, AWError * _Nonnull error) {
    if (success) {
      //init success ,do something
    } else {
      // init failed,check error
    }
  }
  
  ///Use the following method for version 2.0.1.3 and above.  
[AWPurchaseKit configureWithAppId:appId 
                           secret:appSecret
                              uid:userId
                       completion:^(BOOL success, AWError * _Nonnull error) {
                 if (success) {
                  //init success ,do something
                } else {
                  // init failed,check error
                }
  }];
```

```Swift
///Please use the following method for versions older than 2.0.1.3.  
AWPurchaseKit.configure(withAppId: appId, 
                              uid: uid) { [weak self](success, error) in
      if success == false {
        // init failed,check error
      } else {
        //init success ,do something
      }
    }
    
 ///Use the following method for version 2.0.1.3 and above.
 AWPurchaseKit.configure(withAppId: appId, 
                            secret:appSecret 
                               uid: uid) { [weak self](success, error) in
      if success == false {
        // init failed,check error
      } else {
        //init success ,do something
      }
    }
```

### Parameters:
	•	appId: Generated by AW server. For the generation steps, please refer to the document: New Application (External Use)
	•	secret: Added in V2.0.1.3 and is generated by AW server. For the generation steps, please refer to the document: New Application (External Use)
- uid: userId should not be empty value.
- completion: Initialization result's block. Returns 'true' if initialization is successful; returns 'false' if not. This component can not be used in the case of configuration failure. 
## 3. Get Products
### Description:
 This method is used to acquire product information. The product information should be loaded before displaying product page.

```Objective-C 
[AWPurchaseKit getProductsInfoWithProductIdentifiers:self.skuSet 
                                          completion:^(RetrievedProducts * _Nonnull retrievedProducts) {
      if (retrievedProducts.error) {
       // request error,check error msg
        return;
      }
      if (retrievedProducts.validProducts.count){
        dispatch_async(dispatch_get_main_queue(), ^{
        // request success, updateUI
        //  [self updateUI];
        });
      }
      if (retrievedProducts.invalidProductIdentifiers.count) {
        //find invalid sku, check your sku
      }
    }];
```

```Swift
AWPurchaseKit.getProductsInfo(withProductIdentifiers: productIds) { [weak self] (result) in
          if let error = result.error {
            //request error,check error msg
          } else {
            let valid_products = result.validProducts
            //request success, updateUI
          }
  }
```
  
### Parameters:
 productIdentifiers: Collection of SKU IDs.
### Return:
 The RetrievedProducts returned includes AWProduct array of successfully obtained products, SKU array of products failed to be obtained and AWError objects.
 AWProduct Data Structure: [AppWheel SDK Integration Document - Introduction to iOS Classes](docs\appwheel\Android Integration Documentation.md)
 
## 4. Purchase Products
### Description:
 This method should be called to complete a purchase when a user has selected a product. The developers should tell the product type before calling this method and then pass the productType to complete the purchase.

```Objective-C 
[AWPurchaseKit purchaseProduct:product 
                      quantity:quantity 
                   AWProducts 
               paymentDiscount:paymentDiscount completion:^(BOOL success, AWError * _Nonnull error) {
                if (!success) {
                  //purchase failed, check error
                }else {
                  //purchase success
                }
          }];
```

```Swift
AWPurchaseKit.purchaseProduct(product, 
                     quantity: 1, 
                  productType: AWProductType, 
              paymentDiscount: nil) { success, error in
        if success {
          //purchase success
        } else {
          //purchase failed, check error
        }
      }
```

### Parameters:
- product: Products
- paymentDiscount: Discounts. Only for subscription products and can be acquired through Product.discounts. No transferable nil. 
- quantity: The quantity of purchases. The quantity of subscription products is 1, as is other product types.
- productType: Product types, which can be determined according to the SKU. There are four product types: (0: Consumable product, 1: Non-consumable product, 2: Auto-renewal subscription, and 3: Non-automatic renewal subscription) Please refer to the AWProductType in [AppWheel SDK Integration Document - Introduction to iOS Classes](docs\appwheel\Android Integration Documentation.md).

## 5. Restore Purchase

### Description:
 This is used to restore valid subscriptions, non-consumable products, and non-renewable products for a user. When there is no valid subscription, the 'success' in the block will return a false value. Calling this interface will directly call the AppleService verification interface and there is a quota restriction for this interface for each app. <font color="red"> **It is strictly prohibited to call when starting the app and to call it too frequently. **</font> It is recommended to call it only when the purchase information fails to be inquired because the user changed their phone or reinstalled the app.

```Objective-C 
[AWPurchaseKit restorePurchaseWithCompletion:^(BOOL success, 
                                            NSArray * validSubscriptions, 
                                            NSArray * purchasedItems, 
                                            AWError * error) {
    //do something
  }];
```

```Swift
AWPurchaseKit.restorePurchase { (success, validSubscriptions, productIds, error) in
      //do something
      }
```

## 6. View User Benefits
### Telling if there is an ongoing subscription service
#### Description:
 Tell if a user has an ongoing subscription service. If yes, this method can be used to tell the benefits the user enjoys.

```Objective-C 
[[AWPurchaseKit getPurchaseInfo] isSubscriptionUnlockedUser]
```

```Swift
AWPurchaseKit.getPurchaseInfo().isSubscriptionUnlockedUser()
```

### Obtain the existing valid subscriptions
#### Description:
 It is used to tell a user's existing valid subscription.

```Objective-C 
[[AWPurchaseKit getPurchaseInfo] getCurrentValidSubscriptions]
```

```Swift
AWPurchaseKit.getPurchaseInfo().getCurrentValidSubscriptions()
```

### Obtain the currently owned non-consumable and non-renewable subscription products.
#### Description:
 It is used to obtain the consumable, non-consumable, and non-renewable subscription items currently owned by the user.

```Objective-C 
[[AWPurchaseKit getPurchaseInfo] purchasedArray]
```

```Swift
AWPurchaseKit.getPurchaseInfo().purchasedArray()
```

## 7. Adding a global listener

### Description:
 This method is used to add a global listener, which will be called after purchase, subscription renewal, and/or restoring purchases. Developers should set up listeners as soon as possible after initialization for callbacks in a timely manner.

```Objective-C 
///Adding a listener
[AWPurchaseKit addPurchaseObserver:AWPurchaseObserver];
///Remove listener
[AWPurchaseKit removePurchaseObserver:self]
```

```Swift
///Adding a listener
AWPurchaseKit.add(AWPurchaseObserver)
///Remove listener
AWPurchaseKit.remove(AWPurchaseObserver)
```

