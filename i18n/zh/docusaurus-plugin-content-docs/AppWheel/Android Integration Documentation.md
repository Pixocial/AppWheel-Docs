---
sidebar_position: 2
title: Android Integration Documentation
id: Android-Integration-Documentation
---
# Android Integration Documentation (External Use)

## 1. Installation
### Description:
 This SDK is hosted on Maven, and we recommend using gradle to install this SDK.
 Add the following code to the project.gradle file:

```gradle
repositories {
   ...
   google()
   jcenter()
}

dependencies {
   ...
   classpath 'com.google.gms:google-services:4.2.0'
}

allprojects {
   repositories {
       google()
       jcenter()
   }
}

```
 
Add the following code to the app.gradle file:

```gradle

apply plugin: 'com.google.gms.google-services'

implementation 'com.github.pixocial:purchases:1.xxx'

```

## 2. SDK Initialization
### Description:
 The SDK initialization method is as follows. Please initialize the SDK in your app as soon as possible according to your own situation.

```java
///Older than version 1.0.5.6
//Initialize the configuration in Application - oncreate. The appId refers to the ID you received when registering. 
Billing.configure(context ,"appid" , appUserId , 
new OnBillingClientSetupFinishedListener(){
    @Override
    public void onBillingSetupFinished(int billingResponseCode) {
        super.onBillingSetupFinished(billingResponseCode);
    }
});
///Version 1.0.5.6 or later
Billing.configure(context ,"appid" , secret,appUserId , 
new OnBillingClientSetupFinishedListener(){
    @Override
    public void onBillingSetupFinished(int billingResponseCode) {
        super.onBillingSetupFinished(billingResponseCode);
    }
});

```


```kotlin

///Older than version 1.0.5.6
//Initialize the configuration in Application - oncreate. The appId refers to the ID you received when registering. 
Billing.configure(context ,"appid" , appUserId , listener)
///Version 1.0.5.6 or later
Billing.configure(context ,"appid" , secret, appUserId , listener)
```
### Parameters:
- appId: Generated by AW. For the generation steps, please refer to the document: New Application (External Use)
- secret: Added in V1.0.5.6 and is generated by AW. For the generation steps, please refer to the document: New Application (External Use)
- uid: userId value should not be empty.
- listener: Initialized listener, which can be empty value. After initialization, the callback result will be successfully returned.
 onBillingSetupFinished method
 
## 3. Get Products
### Description:
 This method is used to acquire product information. The product information should be loaded before displaying product page.

```java
Market.getInstance().getProductsInfo(itemType, skuList, new OnQueryProductListener() {
    @Override
    public void onSuccess(List<Product> productInfo) {
    }

    @Override
    public void onError(int resultCode) {

    }
});
```

```kotlin
Market.getInstance().getProductsInfo(itemType, skuList, object : OnQueryProductListener {
    override fun onSuccess(productInfo: List<Product>) {
        
    }
    override fun onError(resultCode: Int) {
        
    }
})
```
### Parameters:
- itemType: SKU types, including INAPP and SUBS.
- skuList : Collection of SKU IDs.
 Return:
When the request is successful, the collection of Products will be returned through the onSuccess method.

## 4. Purchase Products
### Description:
 This method should be called to complete a purchase when a user has selected a product. The developers should tell the product type before calling this method and then pass the productType to complete the purchase.

```java
Market.getInstance().purchaseProduct(ProductDetailActivity.this, mProduct, new InitiatePurchaseListener() {
    @Override
    public void onVerifying(boolean isVerifying) {
       // Callback of onging verification in the backend
    }

    @Override
    public void onPurchaseSuccess(MTGPurchase purchase) {
       //Purchase success callback
   }

    @Override
    public void onOwnedGoods(MTGPurchase purchase) {
       //Purchased status callback
    }

    @Override
    public void onPurchaseError(int errorCode) {
       //Callback of abnormal purchases
    }
});
```

```kotlin
Market.getInstance().purchaseProduct(activity, mProduct, object : InitiatePurchaseListener {
    override fun onVerifying(isVerifying: Boolean) {
        //Callback of ongoing backend verification
    }

    override fun onPurchaseSuccess(purchase: MTGPurchase) {
        //Purchase success callback
    }

    override fun onOwnedGoods(purchase: MTGPurchase) {
        //Purchased status callback
    }

    override fun onPurchaseError(errorCode: Int) {
        //Callback of abnormal purchases
    }
})
```
### Parameters:
- product: Products to be purchased

### Consumption

#### Description:
 The paymentType for INAPP products is 2 and there is no need to use this interface for subscription products. If the purchased INAPP products are not consumed, then cannot be purchased again until they are consumed.

```java
Market.getInstance().consumePurchaseFlow(purchase, new ConsumeResponseListener() {
    @Override
    public void onConsumeResponse(int resultCode) {
        if(resultCode == Types.BillingResponseCode.OK){
            BillingLog.i(TAG , "consumeMembership Success -" + purchase.getProductId());
        }
    }
});
```

```kotlin
Market.getInstance().consumePurchaseFlow(purchase, object : ConsumeResponseListener() {
    fun onConsumeResponse(resultCode: Int) {
        if (resultCode == Types.BillingResponseCode.OK) {
            BillingLog.i(TAG, "consumeMembership Success -" + purchase.getProductId())
        }
    }
})
```
#### Parameters:
- purchase: MTGPurchase type. Please choose the corresponding purchase value according to the products you need.


## 5. Restore Purchase
### Description:
 This is used to restore valid subscriptions, non-consumable products, and non-renewable products for a user. When there is no valid subscription, the 'success' in the block will return a false value. Calling this interface will directly call the AppleService verification interface. There is a quota restriction for this interface for each app, <font color="red"> **so it is strictly prohibited to call when starting the app and to call it too frequently.**</font> It is recommended to call it only when the purchase information fails to be inquired because the user changed their phone or reinstalled the app.

```java
Market.getInstance().restorePurchase(new OnRestorePurchaseListener() {
    @Override
    public void onSuccess(List<MTGPurchase> purchases) {
    }

    @Override
    public void onError(int resultCode) {
    }
});
```

```kotlin
Market.getInstance().restorePurchase(object : OnRestorePurchaseListener {
    override fun onSuccess(purchases: List<MTGPurchase>) {
    }
    override fun onError(resultCode: Int) {
    }
})
```

## 6. View User Benefits
 The following method is used to check a user's existing purchased products.
### Obtain the current valid orders
#### Description:
 The following method is used to check a user's existing valid orders, including valid subscription and unconsumed INAPP products.

```java
UserOrderManager.getProvider().getOrders()
```

```kotlin
UserOrderManager.getProvider().getOrders()
```

### Obtain current subscription
#### Description:
 This method is used to obtain a user's existing valid subscription. If there is no valid subscription, an empty result will be returned.

```java
SubsPurchase recentSubsPurchase = UserOrderManager.getProvider().getRecentSubsPurchase();
```

```kotlin
val recentSubsPurchase = UserOrderManager.getProvider().recentSubsPurchase
```

## 7. Adding a global listener
### Description:
 This method is used to add a global listener, which will be called after purchase, subscription renewal, and/or restoring purchases. Developers should set up listeners as soon as possible after initialization for callbacks in a timely manner.

```java
///Adding a listener
UserOrderManager.getProvider().addPurchaseObserver(new OrderObserver() {
    @Override
    public void onUpdateOrders(List<MTGPurchase> purchases) {
        // Monitor order changes
    }
});
///Remove listener
UserOrderManager.getProvider().removePurchaseObserver(orderObserver);
```

```kotlin
///Adding a listener
UserOrderManager.getProvider().addPurchaseObserver {
    //Monitoring order changes
} 
///Remove listener
UserOrderManager.getProvider().removePurchaseObserver(orderObserver)
```
## For more functions, please refer to the document: AppWheel SDK Integration Document - Android

