<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="AppWheel-Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="AppWheel-Docs Atom Feed"><title data-rh="true">AppWheel SDK Integration Document | AppWheel-Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/AppWheel/AppWheel-SDK-Integration-Document"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AppWheel SDK Integration Document | AppWheel-Docs"><meta data-rh="true" name="description" content="Overall Process"><meta data-rh="true" property="og:description" content="Overall Process"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/AppWheel/AppWheel-SDK-Integration-Document"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/AppWheel/AppWheel-SDK-Integration-Document" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/AppWheel/AppWheel-SDK-Integration-Document" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3b98a603.css">
<link rel="preload" href="/assets/js/runtime~main.8b4c466e.js" as="script">
<link rel="preload" href="/assets/js/main.e43b240f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="AppWheel Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="AppWheel Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">AppWheel</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/tutorial-basics/create-a-page">Tutorial - Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/tutorial-extras/manage-docs-versions">Tutorial - Extras</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/AppWheel/AppWheel-SDK-Integration-Document">AppWheel</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/AppWheel/AppWheel-SDK-Integration-Document">AppWheel SDK Integration Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AppWheel/Android-Integration-Documentation">Android Integration Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AppWheel/iOS-Integration-Document">iOS Integration Document</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">🏠</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">AppWheel</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/AppWheel/AppWheel-SDK-Integration-Document">AppWheel SDK Integration Document</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>AppWheel SDK Integration Document</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="overall-process">Overall Process<a class="hash-link" href="#overall-process" title="Direct link to heading">​</a></h2><p>（欠缺流程图，因为现在没有仓库放）</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ios-integration">iOS Integration<a class="hash-link" href="#ios-integration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-1-create-an-app">Step 1: Create an app<a class="hash-link" href="#step-1-create-an-app" title="Direct link to heading">​</a></h3><ul><li><strong>App name:</strong> The name of your app</li><li><strong>Store:</strong> The platform that is divided into Android and iOS, and you should select iOS in this case.</li><li><strong>App Bundle ID:</strong> bundleID is the identifier of your app in the Apple App Store, which can be obtained by viewing your app in App Store Connect.</li><li><strong>iTunesConnect App Specific Shared Secret:</strong> The shared secret, which is needed to verify the order receipt generated by your app. For the acquisition method, please refer to: <a href="https://help.apple.com/app-store-connect/#/devf341c0f01" target="_blank" rel="noopener noreferrer">https://help.apple.com/app-store-connect/#/devf341c0f01</a>. There are two shared keys: One is the shared key for all apps; the other is a shared key for a single app. A shared key for a single app is recommended.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-2-configuration">Step 2: Configuration<a class="hash-link" href="#step-2-configuration" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="notification-receiving-configuration-important-if-you-have-your-own-receiving-server-please-refer-to-the-configure-notification-receiving-server">Notification Receiving Configuration(<font color="red"> <strong>Important: If you have your own receiving server, please refer to the &quot;Configure Notification Receiving Server&quot;</strong></font>)<a class="hash-link" href="#notification-receiving-configuration-important-if-you-have-your-own-receiving-server-please-refer-to-the-configure-notification-receiving-server" title="Direct link to heading">​</a></h4><p>To send Apple server notifications to Appwheel, please configure the following address (<a href="https://msgserver-dot-subscription-saas.uc.r.appspot.com/subcenter/receive_ios_notification" target="_blank" rel="noopener noreferrer">https://msgserver-dot-subscription-saas.uc.r.appspot.com/subcenter/receive_ios_notification</a>) to Apple Store Connect: (Currently supports V1 type notifications)</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="configure-notification-receiving-server">Configure Notification Receiving Server<a class="hash-link" href="#configure-notification-receiving-server" title="Direct link to heading">​</a></h4><p>▪ If you have your own notification receiving server that needs the push data, you can set the receiving server address in the AppWheel main site. We will send each message once in the order in which the messages arrive, but sometimes the messages may not be delivered in sequence, or will be transmitted multiple times. You should design the program in the way of idempotent processing.</p><p>￮ After the configuration is complete, you can test the availability of the address. The configuration must be consistent with the requirements, that is, accept the request of the POST method, return 200 Http status code after successful processing, and return 400 or 500 status code when processing fails. In addition, because there is no actual business data body in the test, the 200 http status code can be returned when empty data is received.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="p8-file-configuration-for-purchasing-discounted-products">p8 file configuration for purchasing discounted products<a class="hash-link" href="#p8-file-configuration-for-purchasing-discounted-products" title="Direct link to heading">​</a></h4><p>When your app has a discount set in the Apple App Store, and you want to sync the information to AppWheel, you need to set the p8 file in AppWheel。
&lt;todo：缺了一张图，因为没有仓库放&gt;
<strong>Service Account credentials JSON:</strong> A file with a .p8 suffix, commonly called a p8 file. When you need to enable the subscription discount function, you need to have a signature for the discount, and the p8 file is an essential key to generate this signature. Obtain it through: <a href="https://help.apple.com/app-store-connect/#/dev689c93225%5D" target="_blank" rel="noopener noreferrer">https://help.apple.com/app-store-connect/#/dev689c93225</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="product-configuration">Product Configuration<a class="hash-link" href="#product-configuration" title="Direct link to heading">​</a></h4><p>▪ There&#x27;s already a product configuration
▪ No product configuration</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-3-sdk-interface-integration">Step 3: SDK interface integration<a class="hash-link" href="#step-3-sdk-interface-integration" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="1-installation">1. Installation<a class="hash-link" href="#1-installation" title="Direct link to heading">​</a></h4><p>The integration should be done with CocoaPods and the following orders should be added to Podfile.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">pod &#x27;AppWheel&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The latest version can be obtained through the official website or by executing pod search AppWheel.
All methods support Swift calls. Please add the following sentences to the Bridging-Header file.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import &lt;PurchaseSDK/AWPurchaseKit.h&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><font color="red">Note: This SDK only supports the real machine rather than a simulator.</font><h4 class="anchor anchorWithStickyNavbar_mojV" id="2-initialize">2. Initialize<a class="hash-link" href="#2-initialize" title="Direct link to heading">​</a></h4><p>Requirements:
The SDK initialization method is as follows. Please initialize the SDK in your app as soon as possible according to your own situation.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit configureWithAppId:appid uid:userId completion:^(BOOL success, AWError * _Nonnull error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (success) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      //init success ,do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // init failed,check error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.configure(withAppId: appId, uid: uid) { [weak self](success, error) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if success == false {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // init failed,check error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //init success ,do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="parameters">Parameters:<a class="hash-link" href="#parameters" title="Direct link to heading">​</a></h5><ul><li>appId: Generated by the server of the subscription center. For the generation steps, please refer to the document: New Application (External Use) </li><li>uid: userId, no empty string for transferring</li><li>completion: Initialization result&#x27;s block. Returns &#x27;true&#x27; if initialization is successful; returns &#x27;false&#x27; if not. This component can not be used in the case of configuration failure. </li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="3-get-products">3. Get Products<a class="hash-link" href="#3-get-products" title="Direct link to heading">​</a></h4><p>Requirements:
This method is used to acquire product information. The product information should be loaded before displaying product page.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[AWPurchaseKit getProductsInfoWithProductIdentifiers:self.skuSet completion:^(RetrievedProducts * _Nonnull retrievedProducts) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (retrievedProducts.error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       // request error,check error msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (retrievedProducts.validProducts.count){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dispatch_async(dispatch_get_main_queue(), ^{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // request success, updateUI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //  [self updateUI];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (retrievedProducts.invalidProductIdentifiers.count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //find invalid sku, check your sku</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.getProductsInfo(withProductIdentifiers: productIds) { [weak self] (result) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if let error = result.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //request error,check error msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            let valid_products = result.validProducts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //request success, updateUI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="parameters-1">Parameters:<a class="hash-link" href="#parameters-1" title="Direct link to heading">​</a></h5><p>Collection of SKU IDs.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="return">Return:<a class="hash-link" href="#return" title="Direct link to heading">​</a></h5><p>The RetrievedProducts returned includes AWProduct array of successfully obtained products, SKU array of products failed to be obtained and AWError objects.
AWProduct Data Structure: AppWheel SDK Integration Document - Introduction to iOS Classes </p><h4 class="anchor anchorWithStickyNavbar_mojV" id="4-purchase-products">4. Purchase Products<a class="hash-link" href="#4-purchase-products" title="Direct link to heading">​</a></h4><p>Requirements:
This method should be called to complete a purchase when a user has selected a product. The developers should tell the product type before calling this method and then pass the productType to complete the purchase.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[AWPurchaseKit purchaseProduct:product quantity:quantity productType:productType paymentDiscount:paymentDiscount completion:^(BOOL success, AWError * _Nonnull error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (!success) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  //purchase failed, check error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  //purchase success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.purchaseProduct(product, quantity: 1, productType: AWProductType, paymentDiscount: nil) { success, error in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if success {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          //purchase success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          //purchase failed, check error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="parameters-2">Parameters:<a class="hash-link" href="#parameters-2" title="Direct link to heading">​</a></h5><ul><li>product: Products</li><li>paymentDiscount: Discounts. Only for subscription products and can be acquired through Product.discounts. No transferable nil. </li><li>quantity: The quantity of purchases. The quantity of subscription products is 1, as is other product types.</li><li>productType: Type of products. There are usually four types: 0: consumable,
1: non-consumable, 2: auto-renewable and 3: non-renewable. Users can tell the type according to the SKU. Please refer to the AWProductType in AppWheel SDK Integration Document - Introduction to iOS Classes.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="5-restore-purchase">5. Restore Purchase<a class="hash-link" href="#5-restore-purchase" title="Direct link to heading">​</a></h4><p>Requirements:
This is used to restore valid subscriptions, non-consumable products, and non-renewable products for a user. When there is no valid subscription, the &#x27;success&#x27; in the block will return a false value. Calling this interface will directly call the AppleService verification interface and there is a quota restriction for this interface for each app. It is strictly prohibited to call when starting the app and to call it too frequently. It is recommended to call it only when the purchase information fails to be inquired because the user changed their phone or reinstalled the app.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[AWPurchaseKit restorePurchaseWithCompletion:^(BOOL success, NSArray * validSubscriptions, NSArray * purchasedItems, AWError * error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.restorePurchase { (success, validSubscriptions, productIds, error) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      //do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="6-view-user-benefits">6. View User Benefits<a class="hash-link" href="#6-view-user-benefits" title="Direct link to heading">​</a></h4><p>Telling if there is an ongoing subscription service
Requirements:
Tell if a user has an ongoing subscription service. If yes, this method can be used to tell the benefits the user enjoys.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[[AWPurchaseKit getPurchaseInfo] isSubscriptionUnlockedUser]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.getPurchaseInfo().isSubscriptionUnlockedUser()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Obtain the existing valid subscriptions
Requirements:
It is used to tell a user&#x27;s existing valid subscription.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[[AWPurchaseKit getPurchaseInfo] getCurrentValidSubscriptions]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.getPurchaseInfo().getCurrentValidSubscriptions()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Obtain the currently owned non-consumable and non-renewable subscription products.
Requirements:
It is used to obtain the consumable, non-consumable, and non-renewable subscription items currently owned by the user.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[[AWPurchaseKit getPurchaseInfo] purchasedArray]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.getPurchaseInfo().purchasedArray()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="7-adding-a-global-listener">7. Adding a global listener<a class="hash-link" href="#7-adding-a-global-listener" title="Direct link to heading">​</a></h4><p>Requirements:
This method is used to add a global listener, which will be called after purchase, subscription renewal, and/or restoring purchases. Developers should set up listeners as soon as possible after initialization for callbacks in a timely manner.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">///添加监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[AWPurchaseKit addPurchaseObserver:AWPurchaseObserver];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///移除监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[AWPurchaseKit removePurchaseObserver:self]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Swift theme-code-block"><div class="codeBlockContent_wNvx Swift"><pre tabindex="0" class="prism-code language-Swift codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/// 添加监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.add(AWPurchaseObserver)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///移除监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit.remove(AWPurchaseObserver)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-4-acceptance-inspection">Step 4: Acceptance Inspection<a class="hash-link" href="#step-4-acceptance-inspection" title="Direct link to heading">​</a></h3><ul><li>□ App Configuration Check</li><li>□ Whether the notification is configured successfully: Check the configuration in the AppStoreConnect backend</li></ul><ul><li>□ App configuration is as follows</li></ul><ul><li>□ Whether the initialization interface is called at startup</li><li>□ Whether the AppWheel SDK can get the information of purchased products</li><li>□ Subscription Products</li><li>□ Discount products (optional)</li><li>□ Discount for new users</li><li>□ Promotion offer</li><li>□ Coupon</li><li>□ Consumable products</li><li>□ Non-consumable products</li><li>□ Non-renewable products</li><li>□ Whether the AppWheel SDK can restore product information</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="other-steps-integration-of-advanced-features">Other steps: Integration of advanced features<a class="hash-link" href="#other-steps-integration-of-advanced-features" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="voucher-machine">Voucher machine<a class="hash-link" href="#voucher-machine" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="obtain-coupons">Obtain coupons<a class="hash-link" href="#obtain-coupons" title="Direct link to heading">​</a></h5><p>Description: Developers should request coupon information as early as possible when necessary.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit queryCouponDetail:((^)(BOOL success,AWCouponModel * _Nullable model, AWError * _Nullable error))completion</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For the returned AWCouponModel data structure, please refer to document: AppWheel SDK Integration Document - Introduction to iOS Classes </p><h5 class="anchor anchorWithStickyNavbar_mojV" id="consume-coupon-code">Consume coupon code<a class="hash-link" href="#consume-coupon-code" title="Direct link to heading">​</a></h5><p>Note: The developer should report the task ID to AppWheel after displaying the coupon to complete the statistics.</p><div class="codeBlockContainer_I0IT language-Objective-C theme-code-block"><div class="codeBlockContent_wNvx Objective-C"><pre tabindex="0" class="prism-code language-Objective-C codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">AWPurchaseKit updateConponStateWithTaskId:(long)taskId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           withCompletion:((^)(BOOL success, AWError * _Nullable error))completion</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Parameter: taskId. The value of AWCouponModel, which is obtained from calling the coupon interface.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="android-integration">Android Integration<a class="hash-link" href="#android-integration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-1-create-an-app-1">Step 1: Create an app<a class="hash-link" href="#step-1-create-an-app-1" title="Direct link to heading">​</a></h3><ul><li><strong>App name</strong>: The name of your app</li><li><strong>Store</strong>: The platform that is divided into Android and iOS, and you should select Android in this case.</li><li><strong>Google Play package</strong>: The package name of your app, which is the unique identifier of your app in the Google Play Store and can be obtained in the Google Play Console</li><li><strong>Service Account credentials JSON</strong>: The json file required by the server to verify the order. Before you obtain this file, please confirm that you have completed the necessary configuration for Google payments, which is described in the Necessary Preparation for AppWheel (Android). When you have completed the configuration, you will have a json file. Please upload this file to our backend to create your Android app accordingly.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-2-configuration-1">Step 2: Configuration<a class="hash-link" href="#step-2-configuration-1" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="notification-receiving-configuration--important-if-you-have-your-own-receiving-server-please-refer-to-the-configure-notification-receiving-server">Notification Receiving Configuration (<font color="red"> <strong>Important: If you have your own receiving server, please refer to the &quot;Configure Notification Receiving Server&quot;</strong></font>)<a class="hash-link" href="#notification-receiving-configuration--important-if-you-have-your-own-receiving-server-please-refer-to-the-configure-notification-receiving-server" title="Direct link to heading">​</a></h4><p>To send Google server notifications to AppWheel, please configure the address (<a href="https://msgserver-dot-subscription-saas.uc.r.appspot.com/subcenter/receive_android_notification" target="_blank" rel="noopener noreferrer">https://msgserver-dot-subscription-saas.uc.r.appspot.com/subcenter/receive_android_notification</a>) on the Google Cloud Platform.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="configure-notification-receiving-server-1">Configure Notification Receiving Server<a class="hash-link" href="#configure-notification-receiving-server-1" title="Direct link to heading">​</a></h4><p>▪ If you have your own notification receiving server that needs the push data, you can set the receiving server address in the AppWheel main site. We will send each message once in the order in which the messages arrive, but sometimes the messages may not be delivered in sequence, or will be transmitted multiple times. You should design the program in the way of idempotent processing.</p><p>▪ After the configuration is complete, you can test the availability of the address. The configuration must be consistent with the requirements, that is, accept the request of the POST method, return 200 Http status code after successful processing, and return 400 or 500 status code when processing fails. In addition, because there is no actual business data body in the test, the 200 http status code can be returned when empty data is received.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="product-configuration-1">Product Configuration<a class="hash-link" href="#product-configuration-1" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="theres-already-a-product-configuration">There&#x27;s already a product configuration<a class="hash-link" href="#theres-already-a-product-configuration" title="Direct link to heading">​</a></h5><h5 class="anchor anchorWithStickyNavbar_mojV" id="no-product-configuration">No product configuration<a class="hash-link" href="#no-product-configuration" title="Direct link to heading">​</a></h5><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-3-android-sdk-interface-integration">Step 3: Android SDK interface integration<a class="hash-link" href="#step-3-android-sdk-interface-integration" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">​</a></h4><p>Requirements:
This SDK is hosted on Maven, and we recommend using gradle to install this SDK.
Add the following code to the project.gradle file:</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> repositories {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    google()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jcenter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dependencies {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    classpath &#x27;com.google.gms:google-services:4.2.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allprojects {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repositories {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        google()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jcenter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p> Add the following code to the app.gradle file:
apply plugin: &#x27;com.google.gms.google-services&#x27;</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">implementation &#x27;com.github.pixocial:purchases:1.0.4&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="initialize">Initialize<a class="hash-link" href="#initialize" title="Direct link to heading">​</a></h4><p>The SDK initialization method is as follows. Please initialize the SDK in your app as soon as possible according to your own situation.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// 在Application中的oncreate中初始化配置，appId为注册应用时候分配的应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Billing.configure(context ,&quot;appid&quot; , appUserId , </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new OnBillingClientSetupFinishedListener(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onBillingSetupFinished(int billingResponseCode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super.onBillingSetupFinished(billingResponseCode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// 在Application中的oncreate中初始化配置，appId为注册应用时候分配的应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Billing.configure(context ,&quot;appid&quot; , appUserId , listener)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Parameters:
• appId: Generated by the server of the subscription center. For the generation steps, please refer to the document: New Application (External Use)
• uid: userId, no empty string for transferring
• listener: Initialized listener, which can be empty value. After initialization, the callback result will be successfully returned.
onBillingSetupFinished method</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="get-products">Get Products<a class="hash-link" href="#get-products" title="Direct link to heading">​</a></h4><p>Requirements:
This method is used to acquire product information. The product information should be loaded before displaying product page.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().getProductsInfo(itemType, skuList, new OnQueryProductListener() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onSuccess(List&lt;Product&gt; productInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onError(int resultCode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().getProductsInfo(itemType, skuList, object : OnQueryProductListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onSuccess(productInfo: List&lt;Product&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onError(resultCode: Int) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Parameters:
￮ itemType: SKU types, including INAPP and SUBS.
￮ skuList : Collection of SKU IDs.
Return:
When the request is successful, the collection of Products will be returned through the onSuccess method.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="purchase-products">Purchase Products<a class="hash-link" href="#purchase-products" title="Direct link to heading">​</a></h4><p>Requirements:
This method should be called to complete a purchase when a user has selected a product. The developers should tell the product type before calling this method and then pass the productType to complete the purchase.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().purchaseProduct(ProductDetailActivity.this, mProduct, new InitiatePurchaseListener() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onVerifying(boolean isVerifying) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       // 后台验证中的回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onPurchaseSuccess(MTGPurchase purchase) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       // 购买成功回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onOwnedGoods(MTGPurchase purchase) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       // 已购买状态回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onPurchaseError(int errorCode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       // 购买异常回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().purchaseProduct(activity, mProduct, object : InitiatePurchaseListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onVerifying(isVerifying: Boolean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 切换后台验证状态回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onPurchaseSuccess(purchase: MTGPurchase) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 购买成功回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onOwnedGoods(purchase: MTGPurchase) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 已购买状态回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onPurchaseError(errorCode: Int) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 购买异常回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Parameters:
￮ product: Products to be purchased
Consumption
Requirements:
The paymentType for INAPP products is 2 and there is no need to use this interface for subscription products. If the purchased INAPP products are not consumed, then cannot be purchased again until they are consumed.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().consumePurchaseFlow(purchase, new ConsumeResponseListener() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onConsumeResponse(int resultCode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(resultCode == Types.BillingResponseCode.OK){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BillingLog.i(TAG , &quot;consumeMembership Success -&quot; + purchase.getProductId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().consumePurchaseFlow(purchase, object : ConsumeResponseListener() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun onConsumeResponse(resultCode: Int) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (resultCode == Types.BillingResponseCode.OK) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BillingLog.i(TAG, &quot;consumeMembership Success -&quot; + purchase.getProductId())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Parameters:
￮ purchase: MTGPurchase type. Please choose the corresponding purchase value according to the products you need.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="restore-purchase">Restore Purchase<a class="hash-link" href="#restore-purchase" title="Direct link to heading">​</a></h4><p>Requirements:
This is used to restore valid subscriptions, non-consumable products, and non-renewable products for a user. When there is no valid subscription, the &#x27;success&#x27; in the block will return a false value. Calling this interface will directly call the AppleService verification interface and there is a quota restriction for this interface for each app. It is strictly prohibited to call when starting the app and to call it too frequently. It is recommended to call it only when the purchase information fails to be inquired because the user changed their phone or reinstalled the app.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().restorePurchase(new OnRestorePurchaseListener() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onSuccess(List&lt;MTGPurchase&gt; purchases) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onError(int resultCode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Market.getInstance().restorePurchase(object : OnRestorePurchaseListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onSuccess(purchases: List&lt;MTGPurchase&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun onError(resultCode: Int) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="view-user-benefits">View User Benefits<a class="hash-link" href="#view-user-benefits" title="Direct link to heading">​</a></h4><p>The following method is used to check a user&#x27;s existing purchased products.
Obtain the current valid orders
Requirements:
The following method is used to check a user&#x27;s existing valid orders, including valid subscription and unconsumed INAPP products.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">UserOrderManager.getProvider().getOrders()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">UserOrderManager.getProvider().getOrders()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Obtain current subscription
Requirements:
This method is used to obtain a user&#x27;s existing valid subscription. If there is no valid subscription, an empty result will be returned.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SubsPurchase recentSubsPurchase = UserOrderManager.getProvider().getRecentSubsPurchase();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">val recentSubsPurchase = UserOrderManager.getProvider().recentSubsPurchase</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="adding-a-global-listener">Adding a global listener<a class="hash-link" href="#adding-a-global-listener" title="Direct link to heading">​</a></h4><p>Requirements:
This method is used to add a global listener, which will be called after purchase, subscription renewal, and/or restoring purchases. Developers should set up listeners as soon as possible after initialization for callbacks in a timely manner.</p><div class="codeBlockContainer_I0IT language-java theme-code-block"><div class="codeBlockContent_wNvx java"><pre tabindex="0" class="prism-code language-java codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/// 添加监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserOrderManager.getProvider().addPurchaseObserver(new OrderObserver() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onUpdateOrders(List&lt;MTGPurchase&gt; purchases) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在这里监听订单变化情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///移除监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserOrderManager.getProvider().removePurchaseObserver(orderObserver);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-Kotlin theme-code-block"><div class="codeBlockContent_wNvx Kotlin"><pre tabindex="0" class="prism-code language-Kotlin codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/// 添加监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserOrderManager.getProvider().addPurchaseObserver {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 客户端在这里监听中台的订单变化情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///移除监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserOrderManager.getProvider().removePurchaseObserver(orderObserver)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="step-4-acceptance-inspection-1">Step 4: Acceptance Inspection<a class="hash-link" href="#step-4-acceptance-inspection-1" title="Direct link to heading">​</a></h3><ul><li><p>□ App Configuration Check</p></li><li><p>□ To make sure a notification is configured successfully: Check if the Google Cloud Pub/Sub queue has notification settings</p></li><li><p>□ The basic configuration is as follows</p></li><li><p>□ Whether the initialization interface is called at startup</p></li><li><p>□ Whether the AppWheel SDK can get the information of purchased products</p></li><li><p>□ Subscription Products</p></li><li><p>□ In-App Products</p></li><li><p>□ Discount products (optional)</p></li><li><p>□ Single Payment Products</p></li><li><p>□ Recurring Payment Products</p></li><li><p>□ Whether the AppWheel SDK can restore product information</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="other-steps-integration-of-advanced-features-1">Other steps: Integration of advanced features<a class="hash-link" href="#other-steps-integration-of-advanced-features-1" title="Direct link to heading">​</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://https://github.com/Pixocial/AppWheel-Docs/docs/AppWheel/AppWheel SDK Integration Document.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/tutorial-extras/translate-your-site"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Translate your site</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/AppWheel/Android-Integration-Documentation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Android Integration Documentation</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overall-process" class="table-of-contents__link toc-highlight">Overall Process</a></li><li><a href="#ios-integration" class="table-of-contents__link toc-highlight">iOS Integration</a><ul><li><a href="#step-1-create-an-app" class="table-of-contents__link toc-highlight">Step 1: Create an app</a></li><li><a href="#step-2-configuration" class="table-of-contents__link toc-highlight">Step 2: Configuration</a></li><li><a href="#step-3-sdk-interface-integration" class="table-of-contents__link toc-highlight">Step 3: SDK interface integration</a></li><li><a href="#step-4-acceptance-inspection" class="table-of-contents__link toc-highlight">Step 4: Acceptance Inspection</a></li><li><a href="#other-steps-integration-of-advanced-features" class="table-of-contents__link toc-highlight">Other steps: Integration of advanced features</a></li></ul></li><li><a href="#android-integration" class="table-of-contents__link toc-highlight">Android Integration</a><ul><li><a href="#step-1-create-an-app-1" class="table-of-contents__link toc-highlight">Step 1: Create an app</a></li><li><a href="#step-2-configuration-1" class="table-of-contents__link toc-highlight">Step 2: Configuration</a></li><li><a href="#step-3-android-sdk-interface-integration" class="table-of-contents__link toc-highlight">Step 3: Android SDK interface integration</a></li><li><a href="#step-4-acceptance-inspection-1" class="table-of-contents__link toc-highlight">Step 4: Acceptance Inspection</a></li><li><a href="#other-steps-integration-of-advanced-features-1" class="table-of-contents__link toc-highlight">Other steps: Integration of advanced features</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.8b4c466e.js"></script>
<script src="/assets/js/main.e43b240f.js"></script>
</body>
</html>